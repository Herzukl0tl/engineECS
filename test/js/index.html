<html>
<head>
    <title>HERZUKLOTL</title>
</head>
<body>
    <canvas id="canvas" width="800" height="400"></canvas>
    <script type="text/javascript" src="../../dist/js/nuclear.js"></script>
    <script type="text/javascript">
        var test = nuclear.module('test')
            .use(nuclear.module('watchers'))
            .system('kinematic', ['position', 'velocity'], function () {
                this.position.x += this.velocity.x;
                this.position.y += this.velocity.y;
            })
            .system('render', ['position', 'size', 'render'], function () {
                var context = this.render.context;

                context.fillStyle = this.render.color;
                context.fillRect(this.position.x, this.position.y, this.size.width, this.size.height);
            })
            .component('position', function (data) {
                return {
                    x : data.x || 0, y : data.y || 0
                };
            })
            .component('velocity', function (data) {
                return {
                    x : data.x || 0, y : data.y || 0
                };
            })
            .component('size', function (data) {
                return {
                    width : data.width || 0, height : data.height || 0
                };
            })
            .component('render', function (data) {
                return {
                    context : data.context || 0, color : data.color || 'black'
                };
            })
            .entity('box', {
               components : ['position', 'size', 'render', 'velocity']
            });

        var canvas = document.getElementById('canvas');

        var background = test.entity('box').create({
            render : {
                context : canvas.getContext('2d'),
                color : 'red'
            },
            size : {
                width : 800,
                height : 600
            }
        });

        /*
        test.component('watcher').add(background).watch('render.color', function (value, old) {
            console.log('changed background color from ' + old + ' to ' + value);
        });//*/

        var box = test.entity('box').create({
            render : {
                context : canvas.getContext('2d'),
                color : 'blue'
            },
            size : {
                width : 50,
                height : 50
            },
            position : {
                x : 100,
                y : 100
            }
        });

        /*
        test.component('watcher').add(box).watch('position.x', function (value, old) {
          console.log('changed box x position from ' + value + ' to ' + old);
        });//*/

        test.on('before:render', function() {
            canvas.getContext('2d').clearRect(0,0,800,600);
        });

        test.on('after:render', function(){
            console.log('after render');
        });

        test.run();

    </script>
</body>
</html>
