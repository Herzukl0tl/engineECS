<html>
<head>
    <title>HERZUKLOTL</title>
</head>
<body>
    <div id="counter"></div>
    <canvas id="canvas" width="800" height="400"></canvas>
    <script type="text/javascript" src="../../dist/js/ecs.js"></script>
    <script type="text/javascript">
        system.define('kinematic', ['position', 'velocity'], function () {
            this.position.x += this.velocity.x;
            this.position.y += this.velocity.y;
        });

        system.define('render', ['position', 'size', 'render'], function () {
            var context = this.render.context;

            context.fillStyle = this.render.color;
            context.fillRect(this.position.x, this.position.y, this.size.width, this.size.height)
        }, {msPerUpdate : 16, strict : false});

        system.define("movement", ["position", "velocity"], function (){
            this.position.x += this.velocity.x*this._deltaTime;
            this.position.y += this.velocity.y*this._deltaTime;
        }, {msPerUpdate : 16, strict : true, extrapolation : true});

        component.define('position', function (data) {
            return {
                x : data.x || 0, y : data.y || 0
            };
        });

        component.define('velocity', function (data) {
            return {
                x : data.x || 0, y : data.y || 0
            };
        });

        component.define('size', function (data) {
            return {
                width : data.width || 0, height : data.height || 0
            };
        });

        component.define('render', function (data) {
            return {
                context : data.context || 0, color : data.color || 'black'
            };
        });

        entity.define('box', {
           components : ['position', 'size', 'render', 'velocity']
        });
        entity.define("player", {
           components : ["position", "size", "render", "velocity"]
        });

        var canvas = document.getElementById('canvas');

        var background = entity('box').create({
            render : {
                context : canvas.getContext('2d'),
                color : 'red'
            },
            size : {
                width : 800,
                height : 600
            }
        });

        component('watcher').add(background).watch('render.color', function (value, old) {
            console.log('changed background color from ' + old + ' to ' + value);
        });

        var box = entity('box').create({
            render : {
                context : canvas.getContext('2d'),
                color : 'blue'
            },
            size : {
                width : 50,
                height : 50
            },
            position : {
                x : 100,
                y : 100
            }

        component('watcher').add(box).watch('position.x', function (value, old) {
          console.log('changed box x position from ' + value + ' to ' + old);
        });

        system.on('before:render', function() {
            canvas.getContext('2d').clearRect(0,0,800,600);
        });

        system.on('after:render', function(){
            console.log('after render');
        });
        function run(){
            system.run();
            requestAnimationFrame(run);
        }
        requestAnimationFrame(run);

    </script>
</body>
</html>
