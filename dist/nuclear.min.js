/* ecs 12-04-2014 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){!function(a,d){"function"==typeof define&&define.amd?define(function(){return d(a)}):"object"==typeof b&&b&&b.exports?b.exports=d(a):"object"==typeof c&&c?c.EventsEmitter=d(a):a.EventsEmitter=d(a)}(this,function(a){"use strict";function b(){}function c(b,c,d,e,f){var i=h;h+=1,"_listeners"in b||(b._listeners={callbacks:Object.create(null),contexts:Object.create(null),times:Object.create(null)}),"_events"in b||(b._events=Object.create(null)),b._listeners.callbacks[i]=d,b._listeners.contexts[i]=e,5===arguments.length&&(b._listeners.times[i]=f),"_memories"in b&&Array.isArray(b._memories[c])&&(a.setImmediate||a.setTimeout)(function(){g(b,i,b._memories[c])},0);var j=b._events[c];return"number"==typeof j?b._events[c]=[j,i]:Array.isArray(j)?j.push(i):b._events[c]=i,i}function d(a,b,c){var d=(a._listeners.callbacks,a._events[b]);if("number"==typeof d)f(a,d);else if(Array.isArray(d))for(var e=d.length,g=0;e>g;g+=1){var h=d[g];f(a,h)}c||delete a._events[b]}function e(a,b,c){var d=a._listeners.callbacks,e=a._events[b];if("number"==typeof e)e in d||(f(a,e),delete a._events[b]);else if(Array.isArray(e)){for(var g=e.length,h=0;g>h;h+=1){var i=e[h];i in d||(f(a,i),e.splice(h,1),g-=1,h-=1)}0!==g||c||delete a._events[b]}}function f(a,b){delete a._listeners.callbacks[b],delete a._listeners.contexts[b],delete a._listeners.times[b]}function g(b,c,d){if(c in b._listeners.callbacks){var e=b._listeners.callbacks[c],g=b._listeners.contexts[c]||a;switch(c in b._listeners.times&&(b._listeners.times[c]-=1,b._listeners.times[c]<1&&f(b,c)),d.length){case 0:return e.call(g);case 1:return e.call(g,d[0]);case 2:return e.call(g,d[0],d[1]);case 3:return e.call(g,d[0],d[1],d[2]);default:return e.apply(g,d)}}}var h=1;return b.prototype.on=function(b,d,e){return 3===arguments.length?"times"in e?e.times<1?0:c(this,b,d,e.context||a,e.times):c(this,b,d,e.context||a):c(this,b,d,a)},b.prototype.once=function(b,d,e){return 3===arguments.length?c(this,b,d,e.context||a,1):c(this,b,d,a,1)},b.prototype.off=function(a){return"_listeners"in this&&a in this._listeners.callbacks?(delete this._listeners.callbacks[a],delete this._listeners.contexts[a],delete this._listeners.times[a],!0):!1},b.prototype.clear=function(a,b){if("_listeners"in this&&"_events"in this){var c,f;switch(arguments.length){case 0:for(a in this._events)d(this,a,!1);break;case 1:if("string"==typeof a)d(this,a,!1);else if(Array.isArray(a))for(f=a.length;f--;)d(this,a[f],!1);else{b=a,c=b.soft||!1;for(a in this._events)b.ghosts?e(this,a,c):d(this,a,c)}break;case 2:if(c=b.soft||!1,"string"==typeof a)b.ghosts?e(this,a,c):d(this,a,c);else if(Array.isArray(a))for(f=a.length;f--;)b.ghosts?e(this,a[f],c):d(this,a[f],c)}}},b.prototype.listeners=function(a){var b=[];if(!("_listeners"in this&&"_events"in this))return b;var c=this._listeners.callbacks,d=this._events[a];if("number"==typeof d)d in c?b.push(c[d]):f(this,d);else if(Array.isArray(d))for(var e=d.length,g=0;e>g;g+=1){var h=d[g];h in c?b.push(c[h]):f(this,h)}return b},b.prototype.remember=function(a){if("_memories"in this||(this._memories=Object.create(null)),Array.isArray(a))for(var b=a.length;b--;)this._memories[a[b]]=null;else this._memories[a]=null},b.prototype.forget=function(a){if("_memories"in this)if(Array.isArray(a))for(var b=a.length;b--;)delete this._memories[a[b]];else delete this._memories[a]},b.prototype.trigger=function(a){var b=Array.prototype.slice.call(arguments,1);if("_memories"in this&&a in this._memories&&(this._memories[a]=b),!("_listeners"in this&&"_events"in this))return!1;var c=this._events[a];if("number"==typeof c)g(this,c,b);else{if(!Array.isArray(c))return!1;for(var d=c.length,e=0;d>e;e+=1){var f=c[e];g(this,f,b)}}return!0},b.mixins=function(a){var c=b.prototype;for(var d in c)a[d]=c[d];return a},b.mixins(b),b})},{}],2:[function(a,b){"use strict";function c(a,b,c){this.name=a,this.definition=b,this._components=Object.create(null),this._disabledComponents=Object.create(null),this.moduleName=c}var d=a("./nuclear.events");c.prototype.of=function(a,b){var c=this._components[a]||this._disabledComponents[a];if(2===arguments.length&&!this.in(a)){if(b.required)throw new Error;b.add&&(c=this.add(a))}return c},c.prototype.in=function(a){return a in this._components||a in this._disabledComponents},c.prototype.add=function(a){if(this.in(a))throw new Error;var b=this.definition.apply(this,arguments);return this._components[a]=b,d.trigger("component:add:"+this.identity(),a,this.name,this.moduleName),d.trigger("component:add",a,this.identity(),this.name,this.moduleName),b},c.prototype.remove=function(a){return this.in(a)?(delete this._components[a],delete this._disabledComponents[a],d.trigger("component:remove:"+this.identity(),a,this.name,this.moduleName),d.trigger("component:remove",a,this.identity(),this.name,this.moduleName),!0):!1},c.prototype.share=function(a,b){if(!this.in(a))return null;var c=this.of(a);if(Array.isArray(b)){var e;for(e=b.length-1;e>=0;e-=1)this._components[b[e]]=c,d.trigger("component:add:"+this.identity(),b[e],this.name,this.moduleName),d.trigger("component:add",b[e],this.identity(),this.name,this.moduleName)}else this._components[b]=c,d.trigger("component:add:"+this.identity(),b,this.name,this.moduleName),d.trigger("component:add",b,this.identity(),this.name,this.moduleName);return c},c.prototype.disable=function(a){return a in this._components?(this._disabledComponents[a]=this._components[a],delete this._components[a],d.trigger("component:disable:"+this.identity(),a,this.name,this.moduleName),d.trigger("component:disable",a,this.identity(),this.name,this.moduleName),!0):!1},c.prototype.enable=function(a){return a in this._disabledComponents?(this._components[a]=this._disabledComponents[a],delete this._disabledComponents[a],d.trigger("component:enable:"+this.identity(),a,this.name,this.moduleName),d.trigger("component:enable",a,this.identity(),this.name,this.moduleName),!0):!1},c.prototype.isEnabled=function(a){if(this.in(a))return a in this._components?!0:!1;throw new Error},c.prototype.identity=function(){return this.name+" from "+this.moduleName},b.exports=c},{"./nuclear.events":9}],3:[function(a,b){"use strict";function c(a){this._seed=a||0,this._value=this._seed}c.prototype.next=function(){return this._value+=1},c.prototype.reset=function(){this._value=this._seed},b.exports=c},{}],4:[function(a,b){"use strict";function c(a,b,c){this.name=a,this.definition=b||function(){},this.moduleName=c}var d,e,f;d=a("./entity-id-generator"),e=new d,f=a("./nuclear.events"),c.next=function(){return e.next()},c.prototype.create=function(a){var b=c.next();return this.definition(b,a),f.trigger("entity:create:"+this.identity(),b,this.name,this.moduleName),f.trigger("entity:create_entity",b,this.identity(),this.name,this.moduleName),b},c.prototype.enhance=function(a,b){return this.definition(a,b),a},c.prototype.identity=function(){return this.name+" from "+this.moduleName},b.exports=c},{"./entity-id-generator":3,"./nuclear.events":9}],5:[function(a,b){"use strict";var c,d;b.exports=c={},d=a("./module"),c.events=a("./nuclear.events"),c.registry=a("./nuclear.registry"),c.component=a("./nuclear.component"),c.entity=a("./nuclear.entity"),c.system=a("./nuclear.system"),c.module=function(a,b){var c;return 1===arguments.length?this.registry.module(a):c=new d(a,b)},c.import=function(a){var b,c;for(c=a.length,b=0;c>b;b+=1)this.registry.import(a[b])}},{"./module":6,"./nuclear.component":7,"./nuclear.entity":8,"./nuclear.events":9,"./nuclear.registry":10,"./nuclear.system":11}],6:[function(a,b){"use strict";function c(a,b){this.name=a.trim(),this.requires=b,this.components=Object.create(null),this.entities=Object.create(null),this.systems=Object.create(null),this._config=Object.create(null)}var d,e,f,g;d=a("./component"),e=a("./entity"),f=a("./system"),g=a("./resolver"),c.prototype.config=function(a){var b,c;if("string"==typeof a)return this._config[b=a];for(b in a)c=Object.getOwnPropertyDescriptor(a,b),c&&Object.defineProperty(this._config,b,c);return this},c.prototype.component=function(a,b){var c;if(1===arguments.length){if(c=this.components[a])return c;throw new Error}if(a in this.components)throw new Error;return this.components[a]=new d(a,b,this.name),this},c.prototype.entity=function(a,b){var c;if(1===arguments.length){if(c=this.entities[a])return c;throw new Error}if(a in this.entities)throw new Error;return this.entities[a]=new e(a,b,this.name),this},c.prototype.system=function(a,b,c,d){var e,h,i,j;if(1===arguments.length){if(e=this.systems[a])return e;throw new Error}if(a in this.systems)throw new Error;for(i=b.length,h=0;i>h;h+=1)j=b[h],""===g.module(j)&&(b[h]=g.module(j,this.name)),console.log("component",b[h]);return this.systems[a]=new f(a,b,c,this.name,d),this},b.exports=c},{"./component":2,"./entity":4,"./resolver":13,"./system":14}],7:[function(a,b){"use strict";function c(a){return f.component(a)}function d(a,b){var c=h[a]||[];c.push(b),h[a]=c}function e(a,b){var d=c.all(a),e=d.indexOf(b);d.splice(e,1)}var f=a("./nuclear.registry"),g=a("./nuclear.events"),h=Object.create(null);c.all=function(a){if(h[a])return h[a];throw new Error},g.on("component:add",d),g.on("component:remove",e),b.exports=c},{"./nuclear.events":9,"./nuclear.registry":10}],8:[function(a,b){"use strict";function c(a){return d.entity(a)}var d=a("./nuclear.registry"),e=a("./nuclear.component"),f=a("./entity"),g=a("./nuclear.events");c.serialize=function(a){var b=Object.create(null),c=e.all(a);b.id=a,b.options=Object.create(null);for(var d=c.length-1;d>0;d--){var f=c[d],g=e(f),h=g.of(a);"function"==typeof h.toJSON&&(h=h.toJSON()),b.options[f]=h}return JSON.stringify(b)},c.deserialize=function(a){a=JSON.parse(a);var b=c.create(a.options);return b},c.remove=function(a){for(var b=e.of(a),c=b.length-1;c>=0;c-=1)e(b[c]).remove(a);return g.trigger("entity:remove",a),!0},c.create=function(a){var b,c=f.next();for(b in a)e(b).add(c,a[b]);return c},b.exports=c},{"./entity":4,"./nuclear.component":7,"./nuclear.events":9,"./nuclear.registry":10}],9:[function(a,b){"use strict";var c;c=a("../../lib/events-emitter.min"),b.exports=new c},{"../../lib/events-emitter.min":1}],10:[function(a,b){"use strict";var c;c=a("./registry"),b.exports=new c},{"./registry":12}],11:[function(a,b){"use strict";function c(a){return e.system(a)}function d(a,b){return a._priority-b._priority}var e=a("./nuclear.registry"),f=a("./nuclear.events");c.priority=function(a,b){return 1===arguments.length?c(a)._priority:(c(a)._priority=b,void e._systemList.sort(d))},c.run=function(){f.trigger("system:before_running",c._list);var a;for(a=0;a<e._systemLength;a++)c(e._systemList[a]).run();f.trigger("system:after_running",e._systemList)},c.disable=function(a){var b=e.systems.indexOf(a);e.systems.splice(b,1)},b.exports=c},{"./nuclear.events":9,"./nuclear.registry":10}],12:[function(a,b){"use strict";function c(){this.modules=Object.create(null),this.components=Object.create(null),this.entities=Object.create(null),this.systems=Object.create(null),this._systemList=[],this._systemLength=0}var d;d=a("./resolver"),c.prototype.import=function(a){var b,c,d,e,f,g,h;if(!(a.name in this.modules)){for(b=a.requires.length,c=0;b>c;c+=1)if(!(a.requires[c]in this.modules))throw new Error;for(this.modules[a.name]=a,d=["components","entities","systems"],c=0;e=d[c];c+=1){f=a[e],g=this[e];for(h in f)"systems"===e&&(this._systemList.push(h+" from "+a.name),++this._systemLength),g[h]=f[h]}}},c.prototype.clear=function(){var a,b,c,d,e;for(a=["modules","components","entities","systems"],b=0;c=a[b];b+=1){d=this[c];for(e in d)delete d[e]}},c.prototype.module=function(a){var b;if(b=this.modules[a])return b;throw new Error},c.prototype.component=function(a){var b,c;if(c=d.module(a))return this.module(c).component(d.name(a));if(b=this.components[a])return b;throw new Error},c.prototype.entity=function(a){var b,c;if(c=d.module(a))return this.module(c).entity(d.name(a));if(b=this.entities[a])return b;throw new Error},c.prototype.system=function(a){var b,c;if(c=d.module(a))return this.module(c).system(d.name(a));if(b=this.systems[a])return b;throw new Error},b.exports=c},{"./resolver":13}],13:[function(a,b){"use strict";var c,d;b.exports=c={},d=/^([^\s]+)((?:\s+from\s+([^\s]+))?(?:\s+as\s+([^\s]+))?)$/,c.validate=function(a){if(!d.test(a))throw new Error},c.name=function(a,b){return this.validate(a),1===arguments.length?RegExp.$1||a:RegExp.$2&&b+RegExp.$2||b},c.alias=function(a,b){return this.validate(a),1===arguments.length?RegExp.$4||"":RegExp.$1+(RegExp.$3?" from "+RegExp.$3:"")+" as "+b},c.module=function(a,b){return this.validate(a),1===arguments.length?RegExp.$3||"":RegExp.$1+" from "+b+(RegExp.$4?" as "+RegExp.$4:"")},c.identity=function(a){if(this.validate(a),RegExp.$1&&RegExp.$3)return RegExp.$1+" from "+RegExp.$3;throw new Error}},{}],14:[function(a,b){"use strict";function c(a,b,c,d,e){e=e||{},this.name=a,this.definition=c,this.components=b.map(m.identity,m),this.aliases=b.map(function(a){return m.alias(a)||m.name(a)}),this.moduleName=d,this._context=Object.create(e.context||null),this.entities=[],this._deferredEntities=[],this._sorterManager=Object.create({comparator:function(){},toDeferred:!1}),this._componentPacks=Object.create(null),this._removeEntities=Object.create(null),this._priority=0,h(this,this.components),void 0!==e.disable&&i(this,e.disable),l.on("system:after_running",function(){this._sorterManager.toDeferred&&(this.entities.sort(this._sorterManager.comparator),this._sorterManager.toDeferred=!1)},{context:this})}function d(a,b,c){a.definition(c,b)}function e(a){for(var b,c=0;c<a._deferredEntities.length;c++)b=a._deferredEntities[c],void 0!==a._removeEntities[b]?(a.remove(b),delete a._removeEntities[b]):a.add(b);a._deferredEntities.length=0}function f(a){this._deferredEntities.push(a)}function g(a,b){this._deferredEntities.push(a),this._removeEntities[a]=b}function h(a,b){var c,d=n;for(d.context=a,c=0;c<b.length;c++)l.on("component:add:"+b[c],f,d),l.on("component:enable:"+b[c],f,d),l.on("component:remove:"+b[c],g,d),l.on("component:disable:"+b[c],g,d)}function i(a,b){for(var c=0;c<b.length;c++)k.disable(b[c])}var j=a("./nuclear.component"),k=a("./nuclear.system"),l=a("./nuclear.events"),m=a("./resolver"),n={};c.prototype.add=function(a){if(this.entities.indexOf(a)>-1)return!1;var b=this.check(a);return null===b?!1:(this.entities.push(a),this._componentPacks[a]=b,!0)},c.prototype.remove=function(a){var b=this.entities.indexOf(parseInt(a));return 0>b?!1:(this.entities.splice(b,1),delete this._componentPacks[a],!0)},c.prototype.check=function(a){var b,c,d=Object.create(null);for(b=this.components.length-1;b>=0;b--){if(c=j(this.components[b]).of(a),void 0===c)return null;d[this.aliases[b]]=c}return d},c.prototype.run=function(a){var b=this;if(e(b),1===arguments.length){if(-1!==this.entities.indexOf(a)){var c=b._componentPacks[a];return l.trigger("system:before:"+b.identity(),a,c,b.name,b.moduleName),d(b,a,c),l.trigger("system:after:"+b.identity(),a,c,b.name,b.moduleName),!0}return!1}l.trigger("system:before:"+b.identity(),b.entities,b._componentPacks,b.name,b.moduleName),null!==b._autosortComparator&&b.entities.sort(b._autosortComparator);for(var f=b.entities.length,g=0;f>g;g++)d(b,b.entities[g],b._componentPacks[b.entities[g]]);return l.trigger("system:after:"+b.identity(),b.entities,b._componentPacks,b.name,b.moduleName),b},c.prototype.sort=function(a){return this._sorterManager.comparator=a,this._sorterManager.toDeferred=!0,this},c.prototype.autosort=function(a){return 0===arguments.length?this._autosortComparator:(this._autosortComparator=a.bind(this._context),this)},c.prototype.refresh=function(){e(this)},c.prototype.identity=function(){return this.name+" from "+this.moduleName},b.exports=c},{"./nuclear.component":7,"./nuclear.events":9,"./nuclear.system":11,"./resolver":13}],15:[function(a){"use strict";var b,c;b=a("./pool"),c=a("./modules/core.watchers"),window.nuclear=a("./core/index"),window.nuclear.import([c]),window.Pool=b.Pool,window.FixedPool=b.FixedPool},{"./core/index":5,"./modules/core.watchers":16,"./pool":21}],16:[function(a,b){"use strict";var c,d,e;c=a("./../../core/index"),d=a("./watcher-component"),e=a("./watch-system"),b.exports=c.module("core.watchers",[]).component("watcher",function(a){return new d(a)}).system("watch",["watchers"],e)},{"./../../core/index":5,"./watch-system":17,"./watcher-component":18}],17:[function(a,b){"use strict";function c(a){var b,c,d,e;b=this.watcher.records;for(c in b)d=b[c],e=d.getter(a),e!==d.old&&d.listener(e,d.old),d.old=e}b.exports=c},{}],18:[function(a,b){"use strict";function c(a){this.entity=a,this.records=Object.create(null)}function d(a){var b,c;return b=d.cache[a],b||(c=a.split("."),d[a]=b=new Function("n",'return function compiledGetter(e) {return n.component("'+c.shift()+'").of(e).'+c.join(".")+"}")(f)),b}function e(a){var b,c;return b=e.cache[a],b||(c=a.split("."),e.cache[a]=b=new Function("n",'return function compiledSetter(e,v) {return n.component("'+c.shift()+'").of(e).'+c.join(".")+"=v}")(f)),b}var f;f=a("./../../core/index"),c.prototype.watch=function(a,b){var c;if("string"==typeof a)this._watch(a,b);else{c=a;for(a in c)this._watch(a,c[a])}},c.prototype._watch=function(a,b){var c,f,g,h;if(a in this.records)throw new Error("A watcher is already defined for the "+a+" path");c=d(a),f=e(a),g=c(this.entity),h={path:a,listener:b,getter:c,setter:f,old:g},this.records[a]=h},d.cache=Object.create(null),e.cache=Object.create(null),c.prototype.unwatch=function(a){var b;if(0===arguments.length)this.records={};else if("string"==typeof a)this._unwatch(a);else{b=a;for(a in b)this._unwatch(a)}},c.prototype._unwatch=function(a){var b;if(b=this.records[a],!b)throw new Error("There is no watcher defined for the "+a+" path");delete this.records[a]},b.exports=c},{"./../../core/index":5}],19:[function(a,b){"use strict";function c(a,b){var d;this._pool=[],this._defered=[],this._size=2===arguments.length&&"size"in b?b.size:c.defaults.size;for(d=0;d<this._size;d+=1)this._pool.push(a())}c.prototype.create=function(){var a;return this._size>0?(a=this._pool[--this._size],this._pool[this._size]=null,a):void 0},c.prototype.defer=function(a){var b;this._size>0?(b=this._pool[--this._size],this._pool[this._size]=null,(setImmediate||setTimeout)(function(){a(b)},0)):this._defered.push(a)},c.prototype.release=function(a){this._defered.length>0?this._defered.shift()(a):this._pool[this._size++]=a},c.prototype.size=function(){return this._pool.length},c.prototype.freeSize=function(){return this._size},c.prototype.allocatedSize=function(){return this._pool.length-this._size},c.defaults={size:100},b.exports=c},{}],20:[function(a,b){"use strict";function c(a,b){this._factory=a,this._pool=[],this._defered=[],2===arguments.length?(this._size="size"in b?b.size:c.defaults.size,this.growth="growth"in b?b.growth:c.defaults.growth,this.threshold="threshold"in b?b.threshold:c.defaults.threshold):(b=c.defaults,this._size=b.size,this.growth=b.growth,this.threshold=b.threshold),this.allocate(this._size)}c.prototype.create=function(){return this._pool.length<this.threshold&&this.allocate(this.growth),this._pool.pop()},c.prototype.defer=function(a){var b;this._pool.length>0?(b=this._pool.pop(),(setImmediate||setTimeout)(function(){a(b)},0)):this._defered.push(a)},c.prototype.allocate=function(a){var b;for(b=0;a>b;b+=1)this._pool.push(this._factory());this._size+=a},c.prototype.release=function(a){this._defered.length>0?this._defered.shift()(a):this._pool.push(a)},c.prototype.size=function(){return this._size},c.prototype.freeSize=function(){return this._pool.length},c.prototype.allocatedSize=function(){return this._size-this._pool.length},c.defaults={size:100,growth:1,threshold:1},b.exports=c},{}],21:[function(a,b,c){"use strict";c.Pool=a("./Pool"),c.FixedPool=a("./FixedPool")},{"./FixedPool":19,"./Pool":20}]},{},[15]);